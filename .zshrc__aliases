##############################################################
# Dev Utils
##############################################################

format() {
  echo "💅 Formatting files with Prettier...";
  npx prettier --write --loglevel=error .;
  echo "✅ Done formatting";
}
lint() {
  echo "🔎 Linting files with ESLint...";
  npx eslint . --ext js,jsx,ts,tsx;
  echo "✅ Done linting";
}
tc() {
  echo "🧐 Type-checking files with TypeScript...";
  npx tsc --noEmit;
  echo "✅ Done type-checking";
}
jest() {
  echo "🧪 Testing files changed on branch...";
  npx jest --changedSince=$(git_dev_branch) --coverage=false;
  echo "✅ Done testing";
}
jestw() {
  echo "🧪👀 Testing files changed on branch on watch...";
  npx jest --changedSince=$(git_dev_branch) --watch --coverage=false;
  echo "✅ Done testing";
}
jesta() {
  echo "🧪 Testing all files...";
  npx jest --coverage=false;
  echo "✅ Done testing";
}
alias va='tc && test && lint && format'
alias vs='tc && lint && format'

##############################################################
# Git
##############################################################

# "git checkout branch"
alias gcob="git co -b"
# "git commit message"
# oh-my-zsh originally has this as "git checkout master", but this makes more sense to me
alias gcm="gc -m"

# "git pull origin main"
alias gpom="git pull origin \$(git_dev_branch)"

# Git diffing with origin/master and origin/<dev_branch>
alias grem="git remote" # (original oh-my-zsh `gr` alias)
alias gr="git rev"
# "git diff origin dev"
alias gdod="git fetch && git diff origin/\$(git_dev_branch)"
# "git diff origin main"
alias gdom="git fetch && git diff origin/\$(git_main_branch)"

##############################################################
# Miscellaneous
##############################################################

# Open fzf files with vim by default
alias go="vim -o \`fzf\`"
# Make sure dotfiles are shown by ls
alias ls="ls -A"
# Log ip to console
alias myip="curl http://ipecho.net/plain; echo"
# Change ping to stop after 5 pings
alias ping="ping -c 5"
alias c="clear"

# Clears the screen and runs the succeeding command(s)
run() {
  clear;
  eval $@;
}

git_dev_branch() {
  if [[ -n $(git branch --list develop) ]]; then 
    echo develop; 
  else 
    echo master; 
  fi 
}
